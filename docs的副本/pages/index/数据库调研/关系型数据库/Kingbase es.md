# **Kingbase es（金仓）**
## **概述**
KingbaseES 是北京人大金仓信息技术股份有限公司研发的，具有自主知识产权的通用数据库产品。该产品面向事务处理类应用，兼顾各类数据分析类应用，可用做管理信息系统、业务及生产系统、决策支持系统、多维数据分析、全文检索、地理信息系统、图片搜索等的承载数据库。

KingbaseES 汇集了人大金仓在数据库领域近二十年的技术积累，包括公司在国家“核高基”重大专项数据库课题的研究成果，是唯一入选国家自主创新产品目录的数据库产品，已广泛适用于电子政务、军工、电力、金融、电信、教育及交通等行业，是国家级、省部级项目中应用最广泛的国产数据库产品。

## **架构**
## **体系结构**
![](/docs/images/guanxixing/Aspose.Words.a10c56e4-d776-45a2-8e4d-e512eb974108.021.png)

最底层是存储管理层，主要实现数据存储管理、数据复制、数据完整性保护、封锁、并发控制、 事务管理、缓存管理、日志空间管理等；存储层之上是SQL处理层，主要负责SQL接口底层(函 数、索引、数据字典、存储过程、触发器)的实现、解析、优化、执行和缓存处理等SQL处理层 之上是传输层，主要实现基于SSL的可信传输。传输层之上为接口层， (ODBC/JDBC/ESQL/PERL/PHP/MYBATIS/HIBERNATE/.NET/EF6)及其驱动程序实现；最上面是工具层，提供给管理员大量便捷高效的数据库管理工具和开发工具。KingbaseES的安全防护手段和策略贯穿以上各个层次，提供特权分立、访问控制、存储加密等 多种安全组件和功能，为数据库管理系统提供内核级的层层安全防护。

逻辑功能架构如下所示。

![](/docs/images/guanxixing/Aspose.Words.a10c56e4-d776-45a2-8e4d-e512eb974108.022.png)

在数据库术语里，KingbaseES使用客户端/服务器的模型。一次KingbaseES会话由下列相关的 进程组成：一个服务器进程，它管理数据库文件、接受来自客户端应用与数据库的联接并且代表客户端在 数据库上执行操作。该数据库服务器程序叫做kingbase。那些需要执行数据库操作的用户的客户端（前端）应用。客户端应用可能本身就是多种多样的：可以是一个面向文本的工具，也可以是一个图形界面的应用，或者是一个通过访问数据库 来显示网页的网页服务器，或者是一个特制的数据库管理工具。一些客户端应用是和 KingbaseES发布一起提供的，但绝大部分是用户开发的。和典型的客户端/服务器应用（C/S应用）一样，这些客户端和服务器可以在不同的主机上。这时 它们通过 TCP/IP 网络连接通讯。请注意，在客户机上可以访问的文件未必能够在数据库服务器 机器上访问（或者只能用不同的文件名进行访问）。 KingbaseES服务器可以处理来自客户端的多个并发请求。因此，它为每个连接启动（"forks"）一个新的进程。从这个时候开始，客户端和新服务器进程就不再经过最初的 kingbase进程的干 涉进行通讯。因此，主服务器进程总是在运行并等待着客户端联接， 而客户端和相关联的服务器 进程则是起起停停。
## **实例结构**
KingbaseES 数据库管理系统，由数据库文件和 KingbaseES 实例组成。 
### 数据库文件
数据库文件为存储用户数据以及元数据的一组磁盘文件。 元数据为描述数据库结构、配置和控制有关的信息。
### KingbaseES实例
包含若干对存储的数据进行操作的数据库服务进程，还包括分配和管理内存，统计各种信息， 以及实现各种协调工作的后台进程。一台设备上，可以同时运行多个实例。 

实例注册成实例服务后，会有唯一的名字标志一个实例。 

一个 KingbaseES实例在操作系统上表现为一个KingbaseES进程，它可以由控制器启动，也可以单独用命令行启动。 

一个 KingbaseES实例管理多个逻辑上的数据库。启动一个 KingbaseES 实例后，使用客户端可以访问到这个实例管理的任意一个数据库。

KingbaseES 实例的结构以及和数据库文件的关系可以表示为：

![](/docs/images/guanxixing/Aspose.Words.a10c56e4-d776-45a2-8e4d-e512eb974108.023.png)

以下是 KingbaseES 实例的详细介绍。

数据库服务进程的多进程结构：

KingbaseES 数据库服务进程，称该进程为一个“KingbaseES 数据库实例”。 在一个数据目录只能同时启动一个实例，不同的数据目录可以同时以不同的端口，手动启动为 不同的实例。 KingbaseES 实例采用多进程架构，因此一个实例中会包含多个进程。这些进程按照功能的不 同可以分为后台进程和服务进程两类：

1、后台进程

（1）KingbaseES主进程

主进程负责统一管理各服务进程和其他后台进程。 该进程负责启动服务进程和其他后台进程，并且在子进程退出的时候做清理工作。 该进程负责分发来自操作系统的信号到各子进程。系统退出时，主进程负责发送信号通 知各子进程退出，然后再停止自己。

（2）后台写进程

在这个进程中，共享缓冲池上的脏页会逐渐定期地写入持久存储(例如HDD、SSD)。

（3）检查点进程

用来执行检查点过程。

（4）自动vacuum进程

会定期地在服务器上执行vacuum。

（5）WAL日志写进程

这个进程周期性地将WAL缓冲区上的WAL数据写入和刷新到持久存储。

（6）统计进程

在此进程中，会收集sys\_stat\_activity和sys\_stat\_database等统计信息。

（7）日志写进程

写日志线程负责将日志缓冲区中的日志页面写出到日志文件中。

（8）归档进程

归档进程负责将日志文件归档到指定的位置。

2、服务进程

对于每个客户端的连接，KingbaseES主进程接收到客户端连接后，会为其创建一个新的服务进程。 

该进程负责实际处理客户端的数据库请求，连接断开时退出。
## **存储结构**
在传统上，数据库集簇所使用的配置和数据文件都被一起存储在集簇的数据目录里，一个常用的目录名为 data。由不同数据库实例所管理的多个集簇可以在同一台机器上共存。 data目录包含几个子目录以及一些控制文件，如下表所示。除了这些必要的东西之外，kingbase.conf、sys\_hba.conf和sys\_ident.conf通常都存储在data中，不过可以把它们放在别的地方。

![](/docs/images/guanxixing/Aspose.Words.a10c56e4-d776-45a2-8e4d-e512eb974108.024.png)
## **特性**
作为 KingbaseES 产品系列最新一代版本，KingbaseES V8R2 在系统的可靠性、可用性、性能和兼容性等方面进行了重大改进，它包括以下主要技术特性：
## **高度容错，稳定可靠**
针对企业级关键业务应用的可持续服务需求，KingbaseES V8R2 提供可在电力、金融、电信等核心业务系统中久经考验的容错功能体系，通过如数据备份、恢复、同步复制、多数据副本等高可用技术，确保数据库 7×24 小时不间断服务，实现 99.999%的系统可用性。
## **应用迁移，简单高效**
针对从异构数据库将应用迁移到 KingbaseES 的场景，KingbaseES V8R2 一方面通过智能便捷的数据迁移工具，实现无损、快速数据迁移；另一方面，KingbaseES V8R2 还提供高度符合标准（如 SQL、ODBC、JDBC 等）、并兼容主流数据库（如 Oracle、SQL Server、MySQL等）语法的服务器端、客户端应用开发接口，可最大限度地降低迁移成本。
## **人性设计，简单易用**
KingbaseES V8R2 版本提供了全新设计的集成开发环境（IDE）和集成管理平台，能有效降低数据库开发人员和管理人员的使用成本，提高开发和管理效率。
## **性能强劲，扩展性强** 
针对企业业务增长带来的数据库并发处理压力，该版本提供了包括并行计算、索引覆盖等技术在内的多种性能优化手段，此外提供了基于读写分离的负载均衡技术，让企业能从容应对高负载大并发的业务。
## **使用场景**
人大金仓数据库作为另一款成熟的国产数据库产品，目前已经广泛应用到了很多政府，通信和金融行业。例如中共中央办公厅，网信办，发改委，审计署，海洋局，卫生部，国家电网，中国电信，光大银行等机构部门。